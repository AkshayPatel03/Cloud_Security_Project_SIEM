# Cloud Security Project: Monitoring Failed Logon Attempts with Azure

This is a walkthrough of how I used Microsoft Azure to create a virtual machine (VM) in the cloud running Windows 10. I exposed the VM to the internet and used Azure Log Analytics Workspace, Microsoft Defender for Cloud, and Azure Sentinel to collect and aggregate the attack data and display it on a map in Microsoft Sentinel. This project showcases the use of several tools and resources.

## Project Overview

The project involves the following steps:
1. Provisioning and configuring a Windows 10 VM in Azure.
2. Exposing the VM to the internet.
3. Using PowerShell to scan the Event Viewer on the VM for EventID 4625 (failed logon attempts).
4. Sending the data to a logfile.
5. Using the IPgeolocation.io API to get geolocation data for the IP addresses of failed logon attempts.
6. Aggregating and displaying the attack data in Microsoft Sentinel.

## Features

- **Microsoft Azure**: Cloud platform used to create and manage the VM.
- **Azure Log Analytics Workspace**: Collects and analyzes data generated by resources in Azure.
- **Microsoft Defender for Cloud**: Provides security management and threat protection for your cloud environment.
- **Azure Sentinel**: Cloud-native SIEM (Security Information and Event Management) tool used to monitor and analyze security data.
- **PowerShell Script**: Scans Event Viewer for failed logon attempts and sends data to a logfile.
- **IPgeolocation.io API**: Retrieves geolocation information for IP addresses involved in failed logon attempts.

## Screenshot

![Screenshot of Microsoft Sentinel map displaying attack data](https://github.com)

## Step-by-Step Instructions

### 1. Provisioning the VM

1. Go to the Azure portal.
2. Create a new virtual machine with the following configuration:
    - Image: Windows 10
    - Size: Standard B2s (2 vcpus, 4 GiB memory)
    - Inbound port rules: Allow RDP (3389)

### 2. Exposing the VM to the Internet

1. Configure the network security group to allow inbound traffic.
2. Update the VM's public IP settings to static.

### 3. Setting Up PowerShell Script

1. Open PowerShell on the VM.
2. Create a script to scan Event Viewer for EventID 4625 and log the data.
3. Use the IPgeolocation.io API to get geolocation data.

    ```powershell
    $logPath = "C:\path\to\logfile.txt"
    $apiKey = "your_api_key"
    
    Get-EventLog -LogName Security -InstanceId 4625 | ForEach-Object {
        $ip = $_.ReplacementStrings[-2]
        $response = Invoke-RestMethod -Uri "https://api.ipgeolocation.io/ipgeo?apiKey=$apiKey&ip=$ip"
        $location = $response | Select-Object -ExpandProperty geo
        Add-Content -Path $logPath -Value "$($ip) - $($location.country_name)"
    }
    ```

### 4. Setting Up Azure Log Analytics Workspace

1. Create a new Log Analytics Workspace in Azure.
2. Link the VM to the Log Analytics Workspace.

### 5. Configuring Microsoft Defender for Cloud

1. Enable Microsoft Defender for Cloud on your Azure subscription.
2. Ensure that the VM is protected by Microsoft Defender.

### 6. Setting Up Azure Sentinel

1. Enable Azure Sentinel on your Log Analytics Workspace.
2. Create a new data connector for your VM.
3. Configure a map to display geolocation data from the IPgeolocation.io API.

## Conclusion

This project was done to gain experience with SIEMs, cloud concepts and resources, APIs, and Microsoft Azure. I learned how to provision and configure resources in the cloud, read SIEM logs, and much more. This was a fun project, and I hope anyone reading this appreciates the work that went into it.

For more detailed instructions and scripts, please refer to the [documentation](https://github.com/yourusername/yourrepository).

## License

This project is licensed under the MIT License - see the LICENSE file for details.
